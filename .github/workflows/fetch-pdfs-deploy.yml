name: Fetch and Host PDFs on GitHub Pages

on:
  workflow_dispatch:  # Manual trigger
  schedule:
    - cron: '0 0 * * 0'  # Weekly on Sunday at midnight UTC (optional)

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow only one concurrent deployment
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  fetch-and-deploy:
    runs-on: ubuntu-latest
    
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup GitHub CLI
        run: |
          # Verify gh CLI is available
          gh --version
      
      - name: Create root directory for PDFs
        run: mkdir -p pdf-root
      
      - name: Download PDF assets from latest release
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          cd pdf-root
          
          echo "Fetching latest release from GourangaDasSamrat/latex-resume-ci..."
          
          # Download all PDF files from the latest release
          gh release download \
            --repo GourangaDasSamrat/latex-resume-ci \
            --pattern "*.pdf" \
            --dir . \
            || echo "Warning: No PDF files found or download failed"
          
          # List downloaded files
          echo "Downloaded PDF files:"
          ls -lh *.pdf 2>/dev/null || echo "No PDF files downloaded"
      
      - name: Generate index.html
        run: |
          cd pdf-root
          
          cat > index.html << 'HTML_EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Resume Repository</title>
              <link rel="preconnect" href="https://fonts.googleapis.com">
              <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
              <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
              <style>
                  * {
                      margin: 0;
                      padding: 0;
                      box-sizing: border-box;
                  }
                  
                  :root {
                      --bg-primary: #0a0e27;
                      --bg-secondary: #1a1f3a;
                      --bg-elevated: #232946;
                      --surface: #2a2f4f;
                      --surface-hover: #353a5f;
                      --primary: #3b82f6;
                      --primary-dark: #2563eb;
                      --primary-light: #60a5fa;
                      --accent: #8b5cf6;
                      --text-primary: #e2e8f0;
                      --text-secondary: #94a3b8;
                      --text-tertiary: #64748b;
                      --success: #10b981;
                      --border: rgba(148, 163, 184, 0.1);
                      --shadow: rgba(0, 0, 0, 0.3);
                      --glow: rgba(59, 130, 246, 0.15);
                  }
                  
                  body {
                      font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                      line-height: 1.6;
                      background: var(--bg-primary);
                      color: var(--text-primary);
                      min-height: 100vh;
                      overflow-x: hidden;
                  }
                  
                  body::before {
                      content: '';
                      position: fixed;
                      top: 0;
                      left: 0;
                      width: 100%;
                      height: 100%;
                      background: 
                          radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
                          radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.08) 0%, transparent 50%);
                      pointer-events: none;
                      z-index: 0;
                  }
                  
                  .app-bar {
                      position: fixed;
                      top: 0;
                      left: 0;
                      right: 0;
                      height: 64px;
                      background: rgba(26, 31, 58, 0.8);
                      backdrop-filter: blur(20px);
                      border-bottom: 1px solid var(--border);
                      z-index: 100;
                      display: flex;
                      align-items: center;
                      padding: 0 24px;
                  }
                  
                  .app-bar-content {
                      max-width: 1280px;
                      width: 100%;
                      margin: 0 auto;
                      display: flex;
                      align-items: center;
                      justify-content: space-between;
                  }
                  
                  .logo-section {
                      display: flex;
                      align-items: center;
                      gap: 12px;
                  }
                  
                  .logo {
                      width: 40px;
                      height: 40px;
                      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
                      border-radius: 8px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      box-shadow: 0 4px 12px var(--glow);
                  }
                  
                  .logo svg {
                      width: 24px;
                      height: 24px;
                      fill: white;
                  }
                  
                  .brand-text {
                      display: flex;
                      flex-direction: column;
                      gap: 2px;
                  }
                  
                  .brand-title {
                      font-size: 18px;
                      font-weight: 500;
                      letter-spacing: -0.5px;
                      color: var(--text-primary);
                  }
                  
                  .brand-subtitle {
                      font-size: 12px;
                      color: var(--text-tertiary);
                      letter-spacing: 0.5px;
                      text-transform: uppercase;
                  }
                  
                  .status-chip {
                      display: flex;
                      align-items: center;
                      gap: 8px;
                      padding: 6px 12px;
                      background: rgba(16, 185, 129, 0.1);
                      border: 1px solid rgba(16, 185, 129, 0.2);
                      border-radius: 16px;
                      font-size: 13px;
                      color: var(--success);
                  }
                  
                  .status-dot {
                      width: 8px;
                      height: 8px;
                      background: var(--success);
                      border-radius: 50%;
                      animation: pulse 2s infinite;
                  }
                  
                  @keyframes pulse {
                      0%, 100% {
                          opacity: 1;
                          box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
                      }
                      50% {
                          opacity: 0.8;
                          box-shadow: 0 0 0 4px rgba(16, 185, 129, 0);
                      }
                  }
                  
                  .container {
                      max-width: 1280px;
                      margin: 0 auto;
                      padding: 96px 24px 48px;
                      position: relative;
                      z-index: 1;
                  }
                  
                  .stats-grid {
                      display: grid;
                      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
                      gap: 20px;
                      margin-bottom: 40px;
                  }
                  
                  .stat-card {
                      background: var(--bg-secondary);
                      border: 1px solid var(--border);
                      border-radius: 12px;
                      padding: 24px;
                      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                      position: relative;
                      overflow: hidden;
                  }
                  
                  .stat-card::before {
                      content: '';
                      position: absolute;
                      top: 0;
                      left: 0;
                      width: 100%;
                      height: 2px;
                      background: linear-gradient(90deg, var(--primary), var(--accent));
                      opacity: 0;
                      transition: opacity 0.3s;
                  }
                  
                  .stat-card:hover {
                      background: var(--bg-elevated);
                      border-color: rgba(59, 130, 246, 0.3);
                      transform: translateY(-2px);
                      box-shadow: 0 12px 24px var(--shadow);
                  }
                  
                  .stat-card:hover::before {
                      opacity: 1;
                  }
                  
                  .stat-icon {
                      width: 48px;
                      height: 48px;
                      background: rgba(59, 130, 246, 0.1);
                      border-radius: 10px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      margin-bottom: 16px;
                      color: var(--primary-light);
                      font-size: 24px;
                  }
                  
                  .stat-label {
                      font-size: 13px;
                      color: var(--text-tertiary);
                      text-transform: uppercase;
                      letter-spacing: 1px;
                      font-weight: 500;
                      margin-bottom: 8px;
                  }
                  
                  .stat-value {
                      font-size: 32px;
                      font-weight: 300;
                      color: var(--text-primary);
                      letter-spacing: -1px;
                  }
                  
                  .section-header {
                      margin-bottom: 24px;
                  }
                  
                  .section-title {
                      font-size: 24px;
                      font-weight: 500;
                      color: var(--text-primary);
                      margin-bottom: 8px;
                      letter-spacing: -0.5px;
                  }
                  
                  .section-subtitle {
                      font-size: 14px;
                      color: var(--text-secondary);
                  }
                  
                  .pdf-list {
                      list-style: none;
                      display: flex;
                      flex-direction: column;
                      gap: 16px;
                  }
                  
                  .pdf-card {
                      background: var(--bg-secondary);
                      border: 1px solid var(--border);
                      border-radius: 12px;
                      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                      position: relative;
                      overflow: hidden;
                  }
                  
                  .pdf-card::after {
                      content: '';
                      position: absolute;
                      top: 0;
                      left: 0;
                      width: 100%;
                      height: 100%;
                      background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
                      opacity: 0;
                      transition: opacity 0.3s;
                      pointer-events: none;
                  }
                  
                  .pdf-card:hover {
                      border-color: rgba(59, 130, 246, 0.4);
                      box-shadow: 0 8px 32px var(--shadow), 0 0 0 1px rgba(59, 130, 246, 0.1);
                      transform: translateY(-2px);
                  }
                  
                  .pdf-card:hover::after {
                      opacity: 1;
                  }
                  
                  .pdf-content {
                      padding: 24px;
                      display: flex;
                      align-items: center;
                      gap: 20px;
                      position: relative;
                      z-index: 1;
                  }
                  
                  .pdf-icon {
                      width: 56px;
                      height: 56px;
                      min-width: 56px;
                      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
                      border-radius: 10px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      box-shadow: 0 8px 16px rgba(59, 130, 246, 0.2);
                      transition: transform 0.3s;
                  }
                  
                  .pdf-card:hover .pdf-icon {
                      transform: scale(1.05);
                  }
                  
                  .pdf-icon svg {
                      width: 32px;
                      height: 32px;
                      fill: white;
                  }
                  
                  .pdf-info {
                      flex: 1;
                      min-width: 0;
                  }
                  
                  .pdf-title {
                      font-size: 16px;
                      font-weight: 500;
                      color: var(--text-primary);
                      margin-bottom: 8px;
                      white-space: nowrap;
                      overflow: hidden;
                      text-overflow: ellipsis;
                  }
                  
                  .pdf-meta {
                      display: flex;
                      align-items: center;
                      gap: 16px;
                      flex-wrap: wrap;
                  }
                  
                  .meta-item {
                      display: flex;
                      align-items: center;
                      gap: 6px;
                      font-size: 13px;
                      color: var(--text-secondary);
                  }
                  
                  .meta-icon {
                      font-size: 16px;
                      opacity: 0.7;
                  }
                  
                  .pdf-badge {
                      display: inline-flex;
                      align-items: center;
                      padding: 4px 10px;
                      background: rgba(59, 130, 246, 0.15);
                      border: 1px solid rgba(59, 130, 246, 0.3);
                      border-radius: 6px;
                      font-size: 11px;
                      font-weight: 500;
                      color: var(--primary-light);
                      text-transform: uppercase;
                      letter-spacing: 0.5px;
                  }
                  
                  .pdf-actions {
                      display: flex;
                      gap: 12px;
                  }
                  
                  .btn {
                      display: inline-flex;
                      align-items: center;
                      gap: 8px;
                      padding: 10px 20px;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      text-decoration: none;
                      border: none;
                      cursor: pointer;
                      transition: all 0.2s;
                      white-space: nowrap;
                  }
                  
                  .btn-primary {
                      background: var(--primary);
                      color: white;
                      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
                  }
                  
                  .btn-primary:hover {
                      background: var(--primary-dark);
                      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
                      transform: translateY(-1px);
                  }
                  
                  .btn-secondary {
                      background: var(--surface);
                      color: var(--text-primary);
                      border: 1px solid var(--border);
                  }
                  
                  .btn-secondary:hover {
                      background: var(--surface-hover);
                      border-color: rgba(59, 130, 246, 0.3);
                  }
                  
                  .btn svg {
                      width: 18px;
                      height: 18px;
                      fill: currentColor;
                  }
                  
                  .empty-state {
                      text-align: center;
                      padding: 80px 24px;
                      background: var(--bg-secondary);
                      border: 1px solid var(--border);
                      border-radius: 12px;
                  }
                  
                  .empty-icon {
                      width: 80px;
                      height: 80px;
                      margin: 0 auto 24px;
                      opacity: 0.3;
                  }
                  
                  .empty-title {
                      font-size: 20px;
                      font-weight: 500;
                      color: var(--text-primary);
                      margin-bottom: 8px;
                  }
                  
                  .empty-subtitle {
                      font-size: 14px;
                      color: var(--text-secondary);
                  }
                  
                  .footer {
                      margin-top: 80px;
                      padding-top: 32px;
                      border-top: 1px solid var(--border);
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      flex-wrap: wrap;
                      gap: 16px;
                  }
                  
                  .footer-text {
                      font-size: 13px;
                      color: var(--text-tertiary);
                  }
                  
                  .footer-link {
                      color: var(--primary-light);
                      text-decoration: none;
                      transition: color 0.2s;
                  }
                  
                  .footer-link:hover {
                      color: var(--primary);
                  }
                  
                  .footer-badge {
                      display: flex;
                      align-items: center;
                      gap: 8px;
                      padding: 8px 16px;
                      background: var(--surface);
                      border: 1px solid var(--border);
                      border-radius: 8px;
                      font-size: 12px;
                      color: var(--text-secondary);
                      font-family: 'Roboto Mono', monospace;
                  }
                  
                  @media (max-width: 768px) {
                      .app-bar {
                          padding: 0 16px;
                      }
                      
                      .brand-subtitle {
                          display: none;
                      }
                      
                      .status-chip {
                          display: none;
                      }
                      
                      .container {
                          padding: 80px 16px 32px;
                      }
                      
                      .stats-grid {
                          grid-template-columns: 1fr;
                      }
                      
                      .pdf-content {
                          flex-direction: column;
                          align-items: flex-start;
                          padding: 20px;
                      }
                      
                      .pdf-actions {
                          width: 100%;
                      }
                      
                      .btn {
                          flex: 1;
                          justify-content: center;
                      }
                      
                      .footer {
                          flex-direction: column;
                          text-align: center;
                      }
                  }
              </style>
          </head>
          <body>
              <header class="app-bar">
                  <div class="app-bar-content">
                      <div class="logo-section">
                          <div class="logo">
                              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                  <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                              </svg>
                          </div>
                          <div class="brand-text">
                              <div class="brand-title">Resume Repository</div>
                              <div class="brand-subtitle">Document Management</div>
                          </div>
                      </div>
                      <div class="status-chip">
                          <div class="status-dot"></div>
                          <span>Live</span>
                      </div>
                  </div>
              </header>
              
              <main class="container">
                  <div class="stats-grid">
                      <div class="stat-card">
                          <div class="stat-icon">ðŸ“„</div>
                          <div class="stat-label">Total Documents</div>
                          <div class="stat-value" id="total-docs">0</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-icon">ðŸ’¾</div>
                          <div class="stat-label">Total Size</div>
                          <div class="stat-value" id="total-size">0 KB</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-icon">ðŸ•’</div>
                          <div class="stat-label">Last Updated</div>
                          <div class="stat-value" id="last-update" style="font-size: 20px;">Today</div>
                      </div>
                  </div>
                  
                  <div class="section-header">
                      <h1 class="section-title">Available Resumes</h1>
                      <p class="section-subtitle">Professional documents ready for download</p>
                  </div>
                  
                  <ul class="pdf-list" id="pdf-list"></ul>
                  
                  <footer class="footer">
                      <div class="footer-text">
                          Powered by <a href="https://github.com/GourangaDasSamrat/latex-resume-ci" class="footer-link" target="_blank">LaTeX Resume CI</a>
                          Â· Automatically updated from latest releases
                      </div>
                      <div class="footer-badge">v1.0.0</div>
                  </footer>
              </main>
              
              <script>
                  function formatFileSize(bytes) {
                      if (bytes === 0) return '0 B';
                      const k = 1024;
                      const sizes = ['B', 'KB', 'MB', 'GB'];
                      const i = Math.floor(Math.log(bytes) / Math.log(k));
                      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
                  }
                  
                  function parseSizeToBytes(sizeStr) {
                      const match = sizeStr.match(/^([\d.]+)\s*(\w+)$/);
                      if (!match) return 0;
                      const value = parseFloat(match[1]);
                      const unit = match[2].toUpperCase();
                      const units = { 'B': 1, 'BYTES': 1, 'KB': 1024, 'MB': 1024*1024, 'GB': 1024*1024*1024 };
                      return value * (units[unit] || 1);
                  }
                  
                  function getDocumentType(filename) {
                      const lower = filename.toLowerCase();
                      if (lower.includes('resume')) return 'Resume';
                      if (lower.includes('cv')) return 'CV';
                      if (lower.includes('cover')) return 'Cover Letter';
                      if (lower.includes('portfolio')) return 'Portfolio';
                      return 'Document';
                  }
                  
                  const icons = {
                      pdf: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M15.5,15C15.5,16.38 14.21,17.5 12.75,17.5C11.29,17.5 10,16.38 10,15V12.5H11.5V15C11.5,15.55 12.06,16 12.75,16C13.44,16 14,15.55 14,15V11H15.5V15M18.5,11H17V17H15.5V11H14V9.5H18.5V11M10,11H8.5V17H7V11H5.5V9.5H10V11Z"/></svg>',
                      download: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/></svg>',
                      view: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/></svg>',
                      empty: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V5H19V19M17,17H7V16H17V17M17,15H7V14H17V15M17,12H7V7H17V12Z"/></svg>'
                  };
                  
                  async function loadPDFs() {
                      try {
                          const response = await fetch('pdfs.json');
                          const pdfs = await response.json();
                          const pdfList = document.getElementById('pdf-list');
                          
                          if (pdfs.length === 0) {
                              pdfList.innerHTML = '<div class="empty-state"><div class="empty-icon">' + icons.empty + '</div><h3 class="empty-title">No Documents Available</h3><p class="empty-subtitle">Documents will appear here once they are uploaded</p></div>';
                              return;
                          }
                          
                          document.getElementById('total-docs').textContent = pdfs.length;
                          const totalBytes = pdfs.reduce((sum, pdf) => sum + parseSizeToBytes(pdf.size), 0);
                          document.getElementById('total-size').textContent = formatFileSize(totalBytes);
                          
                          pdfs.forEach((pdf) => {
                              const li = document.createElement('li');
                              const docType = getDocumentType(pdf.name);
                              li.innerHTML = '<div class="pdf-card"><div class="pdf-content"><div class="pdf-icon">' + icons.pdf + '</div><div class="pdf-info"><div class="pdf-title">' + pdf.name + '</div><div class="pdf-meta"><div class="meta-item"><span class="meta-icon">ðŸ“Š</span><span>' + pdf.size + '</span></div><div class="pdf-badge">' + docType + '</div></div></div><div class="pdf-actions"><a href="' + pdf.name + '" class="btn btn-secondary" target="_blank">' + icons.view + '<span>Preview</span></a><a href="' + pdf.name + '" class="btn btn-primary" download>' + icons.download + '<span>Download</span></a></div></div></div>';
                              pdfList.appendChild(li);
                          });
                      } catch (error) {
                          console.error('Error:', error);
                          document.getElementById('pdf-list').innerHTML = '<div class="empty-state"><div class="empty-icon">' + icons.empty + '</div><h3 class="empty-title">Error Loading Documents</h3><p class="empty-subtitle">Please try refreshing the page</p></div>';
                      }
                  }
                  
                  const now = new Date();
                  document.getElementById('last-update').textContent = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                  loadPDFs();
              </script>
          </body>
          </html>
          HTML_EOF
          
          echo "index.html generated successfully"
      
      - name: Create PDFs metadata JSON
        run: |
          cd pdf-root
          echo "[" > pdfs.json
          first=true
          shopt -s nullglob
          for pdf in *.pdf; do
              if [ -f "$pdf" ]; then
                  size=$(stat -c%s "$pdf" 2>/dev/null || echo "0")
                  if [ "$size" -lt 1024 ]; then
                      size_formatted="${size} Bytes"
                  elif [ "$size" -lt 1048576 ]; then
                      size_formatted="$(( size / 1024 )) KB"
                  else
                      size_formatted="$(( size / 1048576 )) MB"
                  fi
                  if [ "$first" = false ]; then
                      echo "," >> pdfs.json
                  fi
                  first=false
                  echo "  {" >> pdfs.json
                  echo "    \"name\": \"$pdf\"," >> pdfs.json
                  echo "    \"size\": \"$size_formatted\"" >> pdfs.json
                  echo -n "  }" >> pdfs.json
              fi
          done
          echo "" >> pdfs.json
          echo "]" >> pdfs.json
          echo "pdfs.json created successfully"
          cat pdfs.json
      
      - name: List all files in root
        run: |
          cd pdf-root
          echo "Files in deployment root:"
          ls -lah
      
      - name: Setup Pages
        uses: actions/configure-pages@v4
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'pdf-root'
      
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
